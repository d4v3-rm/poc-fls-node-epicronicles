import{r as N,a as Y,b as G,j as e,u as v,c as U,s as w,d as z,e as L}from"./index-Dgdhkn7O.js";import"./react-OvXVS5lI.js";import"./three-qq_8ZfES.js";const $=({design:a,templates:r,queueLength:f,queueLimit:o,canAfford:h,selectedTemplateId:m,onSelectTemplate:T,customState:n,setCustomState:x,onBuild:_,onBuildCustom:g})=>{const[S,O]=N.useState(!1),E=m&&r.length>0?Y(a,r.find(i=>i.id===m)??r[0]):a,C=1+(n.offense+n.defense+n.hull)*.08,y=G(E,{attackBonus:n.offense*2,defenseBonus:n.defense*1.5,hullBonus:n.hull*3,costMultiplier:C,name:n.name||void 0}),d=S?y:E,I=h(a.buildCost),k=f>=o||!I,B=h(y.buildCost),j=f>=o||!B,u=m&&r.find(i=>i.id===m)?.name;return e.jsxs("div",{className:"shipyard-panel__card",children:[e.jsxs("div",{className:"shipyard-card__header",children:[e.jsxs("div",{className:"shipyard-card__header-left",children:[e.jsx("strong",{className:"shipyard-card__title",children:a.name}),u?e.jsx("p",{className:"shipyard-card__subtitle",children:u}):null,a.description?e.jsx("p",{className:"shipyard-card__description",children:a.description}):null]}),e.jsx("div",{className:"shipyard-card__badges",children:e.jsxs("span",{className:"pill pill--glass",title:"Tempo di costruzione",children:["T: ",a.buildTime," tick"]})})]}),e.jsxs("div",{className:"shipyard-card__section",children:[e.jsx("p",{className:"text-muted",children:"Costi"}),e.jsxs("div",{className:"shipyard-card__meta",children:[Object.entries(d.buildCost??{}).map(([i,c])=>c?e.jsxs("span",{className:"pill pill--cost",children:[i,": ",c]},i):null),!d.buildCost||Object.values(d.buildCost).every(i=>!i)?e.jsx("span",{className:"pill pill--cost",children:"N/A"}):null]})]}),e.jsxs("div",{className:"shipyard-card__section",children:[e.jsx("p",{className:"text-muted",children:"Statistiche"}),e.jsxs("div",{className:"shipyard-card__meta",children:[e.jsxs("span",{className:"pill pill--stat pill--stat-attack",children:["Atk ",d.attack]}),e.jsxs("span",{className:"pill pill--stat pill--stat-defense",children:["Def ",d.defense]}),e.jsxs("span",{className:"pill pill--stat pill--stat-hull",children:["Hull ",d.hullPoints]})]})]}),S&&e.jsxs("div",{className:"shipyard-card__editor",children:[r.length>0?e.jsxs("label",{className:"fleet-panel__order",children:[e.jsx("span",{className:"text-muted",children:"Template"}),e.jsxs("select",{value:m,onChange:i=>T(i.target.value),children:[e.jsx("option",{value:"",children:"Base"}),r.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}):null,e.jsxs("label",{className:"panel__field",children:["Offesa (+2 atk per punto)",e.jsx("input",{type:"range",min:0,max:4,value:n.offense,onChange:i=>x(c=>({...c,[a.id]:{...n,offense:Number(i.target.value)}}))})]}),e.jsxs("label",{className:"panel__field",children:["Difesa (+1.5 def per punto)",e.jsx("input",{type:"range",min:0,max:4,value:n.defense,onChange:i=>x(c=>({...c,[a.id]:{...n,defense:Number(i.target.value)}}))})]}),e.jsxs("label",{className:"panel__field",children:["Hull (+3 hp per punto)",e.jsx("input",{type:"range",min:0,max:4,value:n.hull,onChange:i=>x(c=>({...c,[a.id]:{...n,hull:Number(i.target.value)}}))})]}),e.jsxs("label",{className:"panel__field",children:["Nome variante",e.jsx("input",{type:"text",value:n.name,onChange:i=>x(c=>({...c,[a.id]:{...n,name:i.target.value}}))})]})]}),e.jsxs("div",{className:"shipyard-card__actions",children:[e.jsx("button",{className:"panel__action panel__action--compact",disabled:S?j:k,onClick:()=>S?g(a.id,a.name,n,m):_(a.id,a.name),children:"Costruisci"}),e.jsx("button",{className:"panel__action panel__action--ghost",onClick:()=>O(i=>!i),children:"Modifica"})]})]})},H=({queue:a})=>e.jsxs("div",{className:"shipyard-panel__queue",children:[e.jsx("h4",{children:"Coda costruzione"}),a.length===0?e.jsx("p",{className:"text-muted",children:"Nessuna nave in costruzione."}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"shipyard-queue__stack",children:a.map((r,f)=>{const o=Math.round(r.progress*100),h=f===0;return e.jsxs("div",{className:`shipyard-queue__item${h?" shipyard-queue__item--current":""}`,children:[e.jsxs("div",{className:"shipyard-queue__top",children:[e.jsx("span",{className:"shipyard-queue__label",children:r.designId}),e.jsxs("span",{className:"pill pill--glass",title:"Tick rimanenti",children:["â± ",r.ticksRemaining]})]}),e.jsx("div",{className:"shipyard-queue__progress",role:"progressbar","aria-valuenow":o,"aria-valuemin":0,"aria-valuemax":100,children:e.jsx("div",{className:"shipyard-queue__progress-fill",style:{width:`${o}%`}})}),e.jsxs("div",{className:"shipyard-queue__meta",children:[e.jsx("span",{children:h?"In lavorazione":`# ${f+1}`}),e.jsxs("span",{className:"text-muted",children:["Tot: ",r.totalTicks," tick"]})]})]},r.id)})})})]}),D={NO_SESSION:"Nessuna sessione.",INVALID_DESIGN:"Progetto nave non valido.",QUEUE_FULL:"Coda cantieri piena.",INSUFFICIENT_RESOURCES:"Risorse insufficienti."},K=({system:a})=>{const r=v(s=>s.config.military.shipDesigns),f=v(s=>s.config.military.shipyard.queueSize),o=v(s=>s.config.military.shipyard.buildCost),h=v(s=>s.queueShipBuild),m=v(s=>s.config.military.templates),T=v(s=>s.buildShipyard),n=v(s=>s.session),[x,_]=N.useState(null),[g,S]=N.useState({}),[O,E]=N.useState({}),R=U(w),C=U(z),y=U(L),d=N.useMemo(()=>s=>R?Object.entries(s).every(([t,l])=>l?(R[t]?.amount??0)>=l:!0):!1,[R]),I=(s,t)=>{const l=g[s],p=h(s,l);p.success?_(`Costruzione ${t} avviata.`):_(D[p.reason])},k=(s,t,l,p)=>{const b=l.offense*2,M=l.defense*1.5,F=l.hull*3,A=1+(l.offense+l.defense+l.hull)*.08,q=h(s,p,{attackBonus:b,defenseBonus:M,hullBonus:F,costMultiplier:A,name:l.name?l.name:void 0});if(q.success){const P=l.name||t||"custom";_(`Variante ${P} avviata.`)}else _(D[q.reason])},B=N.useMemo(()=>C.map(s=>({...s,progress:1-s.ticksRemaining/Math.max(1,s.totalTicks)})),[C]),j=N.useMemo(()=>new Set(y?Object.values(y.branches).flatMap(s=>s.completed):[]),[y]),u=N.useMemo(()=>!n||!a?{ok:!1,reason:"NO_SESSION"}:a.visibility!=="surveyed"?{ok:!1,reason:"SYSTEM_NOT_SURVEYED"}:a.hasShipyard?{ok:!1,reason:"ALREADY_BUILT"}:j.has("orbital-shipyard")?n.fleets.some(t=>t.systemId===a.id&&t.ships.some(l=>r.find(p=>p.id===l.designId)?.role==="construction"))?a.shipyardBuild?{ok:!1,reason:"IN_PROGRESS"}:d(o)?{ok:!0}:{ok:!1,reason:"INSUFFICIENT_RESOURCES"}:{ok:!1,reason:"NO_CONSTRUCTOR"}:{ok:!1,reason:"TECH_MISSING"},[n,a,j,r,o,d]),i=()=>{if(!a)return;const s=T(a.id,a.shipyardAnchorPlanetId??null);s.success?_("Costruzione cantiere avviata (10 tick)."):s.reason&&_({NO_SESSION:"Nessuna sessione attiva.",SYSTEM_NOT_FOUND:"Sistema non valido.",SYSTEM_NOT_SURVEYED:"Il sistema deve essere ispezionato.",TECH_MISSING:"Richiede la tecnologia Cantiere orbitale.",ALREADY_BUILT:"Cantiere gia presente.",NO_CONSTRUCTOR:"Serve una nave costruttrice nel sistema.",INSUFFICIENT_RESOURCES:"Risorse insufficienti.",IN_PROGRESS:"Costruzione gia in corso."}[s.reason]??"Azione non disponibile.")},c=s=>{if(s==="constructor")return!0;const t=j.has("orbital-shipyard");return s==="colony"?t&&j.has("colony-foundations"):s==="science"?t&&j.has("science-outfitting"):s==="corvette"||s==="frigate"?t:!0};return e.jsxs("section",{className:"shipyard-panel shipyard-panel--columns",children:[e.jsxs("header",{className:"shipyard-panel__header",children:[e.jsx("div",{children:e.jsx("h3",{children:a?`Sistema ${a.name}`:"Cantiere orbitale"})}),e.jsx("div",{className:"shipyard-panel__header-meta"})]}),x?e.jsx("p",{className:"panel-message",children:x}):null,a&&(!a.hasShipyard||a.shipyardBuild)?e.jsx("div",{className:"shipyard-panel__empty",children:a.shipyardBuild?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-muted",children:"Costruzione cantiere in corso."}),e.jsxs("p",{className:"text-muted",children:["Progresso: ",Math.round((1-a.shipyardBuild.ticksRemaining/Math.max(1,a.shipyardBuild.totalTicks))*100),"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-muted",children:"Nessun cantiere orbitale in questo sistema. Usa una nave costruttrice per costruirlo."}),e.jsxs("p",{className:"text-muted",children:["Costo: energia ",o.energy??0," / minerali ",o.minerals??0]}),e.jsx("button",{className:"panel__action",onClick:i,disabled:!u.ok,children:"Costruisci cantiere"}),u.ok?null:e.jsx("small",{className:"text-muted",children:u.reason==="TECH_MISSING"?"Richiede tecnologia Cantiere orbitale.":u.reason==="NO_CONSTRUCTOR"?"Serve una nave costruttrice nel sistema.":u.reason==="SYSTEM_NOT_SURVEYED"?"Il sistema deve essere ispezionato.":u.reason==="INSUFFICIENT_RESOURCES"?"Risorse insufficienti.":u.reason==="IN_PROGRESS"?"Costruzione gia in corso.":null})]})}):null,a?.hasShipyard?e.jsxs("div",{className:"shipyard-panel__columns",children:[e.jsx("div",{className:"shipyard-panel__col shipyard-panel__col--designs",children:e.jsx("div",{className:"shipyard-panel__grid",children:r.filter(s=>c(s.id)).map(s=>{const t=m.filter(b=>b.base===s.id),l=g[s.id]??"",p=O[s.id]??{offense:0,defense:0,hull:0,name:""};return e.jsx($,{design:s,templates:t,queueLength:C.length,queueLimit:f,canAfford:d,selectedTemplateId:l,onSelectTemplate:b=>S(M=>({...M,[s.id]:b})),customState:p,setCustomState:E,onBuild:I,onBuildCustom:k},s.id)})})}),e.jsx("aside",{className:"shipyard-panel__col shipyard-panel__col--queue-right shipyard-queue__section",children:e.jsx(H,{queue:B})})]}):null]})};export{K as ShipyardWindow};
